<hr>
<h4>Comments ({{ comment_count }})</h4>
{% if current_user.is_authenticated %}
  <form method="POST">
    {{ form.hidden_tag() }}
    <div class="form-group">
      <small><i>{{ form.content.label }}</i></small>
      {{ form.content(class="form-control", rows="1") }}
    </div>
    {{ form.submit(class="btn btn-outline-info") }}
  </form>
{% else %}
  <small class="text-muted"><i>You must be logged in to comment.</i></small>
{% endif %}
<hr>
{% for comment in comments.items %}
  <div class="media mb-3">
    <img class="rounded-circle mr-3"
         src="{{ url_for('static', filename='profile_pics/' + comment.author.image_file) }}"
         width="50">

    <div class="media-body">
      <!-- AUTHOR + BUTTONS ROW -->
      <div class="d-flex justify-content-between align-items-start">
        <h6 class="mt-0 mb-0">
          {{ comment.author.username }}
          <small class="text-muted">
            {{ comment.date_posted.strftime('%Y-%m-%d %H:%M') }}
          </small>
        </h6>
        {% if comment.author == current_user or current_user.is_admin %}
          <div>
            <a href="{{ url_for('posts.update_comment', comment_id=comment.id) }}"
               class="btn btn-sm btn-outline-secondary">Update</a>

            <form action="{{ url_for('posts.delete_comment', comment_id=comment.id) }}"
                  method="POST"
                  style="display:inline;">
              <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
            </form>
          </div>
        {% endif %}
      </div>
      <!-- COMMENT TEXT -->
      {% if comment.author == current_user or current_user.is_admin %}
        <p>{{ comment.content }}</p>
      {% else %}
        <p class="mt-2">{{ comment.content }}</p>
      {% endif %}
    </div>
  </div>
{% else %}
  <p class="text-muted">No comments yet. Be the first to comment!</p>
{% endfor %}
<div class="pagination mt-3 mr-2 mb-4">
    {% if comments.has_prev %}
        <a class="btn btn-outline-info btn-sm mr-2" href="{{ url_for('posts.post', post_id=post.id, page=comments.prev_num) }}">Previous</a>
    {% endif %}
    {% for page_num in comments.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}
            {% if comments.page == page_num %}
                <a class="btn btn-info btn-sm mr-2" href="{{ url_for('posts.post', post_id=post.id, page=page_num) }}">{{ page_num }}</a>
            {% else %}
                <a class="btn btn-outline-info btn-sm mr-2" href="{{ url_for('posts.post', post_id=post.id, page=page_num) }}">{{ page_num }}</a>
            {% endif %}
        {% else %}
            ...
        {% endif %}
    {% endfor %}
    {% if comments.has_next %}
        <a class="btn btn-outline-info btn-sm mr-2" href="{{ url_for('posts.post', post_id=post.id, page=comments.next_num) }}">Next</a>
    {% endif %}
</div>

